generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TradeEvent {
  id           String   @id @default(cuid())
  tid          BigInt?
  hash         String?
  coin         String
  side         String
  px           Decimal
  sz           Decimal
  notionalUsd  Decimal
  crossed      Boolean
  tradeTime    BigInt
  isLiquidation Boolean @default(false)
  liquidation  Json?
  raw          Json
  ingestedAt   DateTime @default(now())

  @@index([coin, tradeTime])
  @@index([isLiquidation, tradeTime])
}

model TradeAggMinute {
  bucketStart   DateTime
  coin          String
  tradesCount   Int      @default(0)
  volumeUsd     Decimal  @default(0)
  buyCount      Int      @default(0)
  buyVolumeUsd  Decimal  @default(0)
  sellCount     Int      @default(0)
  sellVolumeUsd Decimal  @default(0)
  liqCount      Int      @default(0)
  liqVolumeUsd  Decimal  @default(0)
  updatedAt     DateTime @updatedAt

  @@id([bucketStart, coin])
  @@index([bucketStart])
}
